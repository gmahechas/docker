services:
  consul:
    container_name: consul
    image: hashicorp/consul-template:0.37
    volumes:
      - consul-secrets:/run/secrets
      - ./templates:/templates
      - ./config.hcl:/etc/consul-template/config.hcl
      - ./role_id:/etc/consul-template/role_id
      - ./secret_id:/etc/consul-template/secret_id
    networks:
      - consul_network
      - vault_network
    command: >
      consul-template -config="/etc/consul-template/config.hcl" -log-level=debug -once

volumes:
  consul-secrets:
    external: true  

networks:
  consul_network:
    name: consul_network
    driver: bridge
  vault_network:
    external: true

